
# IM（PC网页/桌面端）三栏式紫色主题交互设计说明 v2（对齐系统架构）

本说明基于《IM（PC网页与桌面端）功能清单》与《IM 系统架构与模块设计规范— 完整版》，输出对齐后端能力与约束的PC三栏式（仿微信）紫色主题交互设计。重点补充：消息状态机映射、大群“提示+拉取”、冷热分层检索、媒体直传与内容安全、权限超时与复核、影子审计提示等。

---

## 0. 全局

### 0.1 布局与自适应
- 三栏结构（可记忆宽度，拖拽可调）  
  - 左：导航（会话/好友/群组/收藏/设置、个人入口）  
  - 中：与导航匹配的列表（会话列表/好友/群/收藏/设置分组）  
  - 右：工作区（聊天/资料/文件中心/设置详情）
- 窄屏降级：优先收起左栏为图标条；双栏模式下中栏与右栏切换。
- 多窗口（桌面端）：会话可在新窗口打开；小窗置顶。

### 0.2 主题与可访问性（紫色系）
- 主题：亮/暗/随系统；主色建议：#6C40FF（亮）/#8F78FF（暗）
- 密度：标准/紧凑；高对比模式；色弱友好（关键状态加图标/文字）。
- 键盘与可达性：Tab 顺序、焦点明显；ARIA 标签覆盖提示条与错误信息。

### 0.3 快捷键
- 全局搜索：Ctrl/Cmd + K
- 模块切换：Alt + 1 会话；Alt + 2 好友；Alt + 3 群组；Alt + 4 收藏；Alt + , 设置
- 会话内搜索：Ctrl/Cmd + F
- 发送/换行：Enter 发送；Shift + Enter 换行（可配置）
- 多选模式：M 进入/Esc 退出
- 新窗口打开会话：Ctrl/Cmd + O

### 0.4 搜索入口
- 顶部全局搜索（人/群/消息/文件/链接/收藏）
- 右栏会话内搜索（就地定位上一条/下一条）

---

## 1. 左栏导航

### 1.1 内容
- 头像与状态：在线/忙碌/离开/勿扰/离线；点击展开个人卡片（二维码、设备管理、退出登录）
- 导航项：会话、好友、群组、收藏、设置
- 徽标：未读红点（紫底白字），汇总计数与@我区分

### 1.2 交互
- 悬停气泡提示；选中高亮（紫色描边/背景）
- 低宽度：收起为窄图标栏，悬停展开

---

## 2. 中栏列表

### 2.1 会话列表
- 列表信息：头像/群头像、名称、摘要、时间、未读计数、免打扰标识、草稿
- 分组：置顶/普通（置顶可拖拽排序）
- 操作（右键/更多）：置顶、标为未读、免打扰（@我是否提醒可配置）、删除会话（移出列表）、清空消息（本端/云端可配）、在新窗口打开
- 发起会话：顶部按钮→搜索人/群/名片；多选建群（可命名/设头像/公告）

大群特例（提示+拉取）
- 当服务端标记为“大群繁忙/内容按需拉取”：
  - 列表项摘要显示“新消息需点开加载内容”
  - 进入会话后，消息以卡片占位，点击卡片拉取正文/图片

### 2.2 好友列表
- 筛选：全部/星标/分组
- 操作：设星标、移动分组、备注、删除、拉黑
- 搜索：姓名/备注/组织字段（若有）

### 2.3 群组列表
- 搜索：群名/公告关键词
- 信息：群名、成员数、公告未读
- 操作：置顶、退群、查看资料、打开文件中心

### 2.4 收藏
- 筛选：消息/图片/文件/链接/代码片段、来源会话、时间
- 批量：转发/导出（是否允许导出由策略控制）

### 2.5 设置（分组）
- 左为分组目录：账号与安全、聊天与输入、外观与主题、文件与下载、通知与声音、隐私与权限、高级与实验、关于
- 右栏打开对应详情页

---

## 3. 右栏聊天/详情

### 3.1 顶部栏
- 左侧：会话名、在线状态/成员数、敏感/管控群标识（盾牌+“受管控”）
- 中部：会话内搜索框（关键字/类型）
- 右侧：详情（抽屉）、文件中心、公告/置顶区、开新窗、更多

### 3.2 消息区
- 气泡：头像、昵称（群）、时间、消息内容（支持Markdown、代码块高亮、链接卡片）
- 类型：文本、表情/贴纸、图片、文件、视频、语音（可开关）、代码片段、名片、投票、位置（可开关）
- 系统/策略提示：禁言、撤回、合规复核、内容检测等以灰底提示或内联标签呈现
- 置顶区：消息区顶部单独区块或抽屉页签（权限与上限受策略）

消息状态机（对齐后端）
- SENDING：“发送中…”（点灰）
- ACCEPTED：已接收/排队中（悬停：服务器已接收）
- STORED：已发送（持久化成功）
- DELIVERED：已送达（单聊显示；群聊默认不逐条显示）
- READ：已读（单聊显示；群聊可显示“已读人数”）
- REVOKED：已撤回（文案统一：“消息已撤回（可能仍在审计留存）”）
- FAILED：发送失败（提供“重试”按钮；复用 clientMsgId）

权限与复核可视化
- 敏感会话发送成功但等待复核：在气泡尾部显示“合规复核中”小盾牌
- 若事后被系统撤回：统一替换为“因合规复核未通过，消息已被系统撤回”，可展开查看原因（若策略允许）

内容安全与扫描
- 媒体/文件发送后显示“内容检测中”徽标；通过后自动消失
- 命中违规：卡片置灰并文案“该内容因违规不可见”；提供“申诉/了解更多”（若开启）

### 3.3 输入区
- 工具条：表情/贴纸、截图/图片、文件、录音（可开关）、@、投票、代码片段、模板短语
- 文本框：支持Markdown、表格粘贴策略（图片化/Markdown/询问并记忆）
- 发送策略：Enter 发送/Shift+Enter 换行（可在设置切换）
- 超长/大文件提示：超阈值二次确认（原图/压缩、分片发送）
- 禁言态：显示“全员禁言中/你被禁言至HH:MM”，发送按钮置灰
- 敏感会话保守默认：首次Enter发送需要确认（可关闭）

### 3.4 单条消息操作（Hover/右键）
- 回复/引用、复制（纯文/含格式）、转发（单条/合并）、撤回（时限可配）、编辑（时限可配，标注“已编辑”）、置顶（权限与上限）、删除（对自己可见/管理员可删他人：可配）、翻译、收藏、标记（重点/待办）

影子审计说明
- 撤回后普通用户仅见“消息已撤回”；审计侧保留只读影子记录（留存期与访问权限由策略控制）
- 前端不展示影子内容，仅在撤回提示中保留简短说明

### 3.5 批量操作
- 多选模式：选中多条后可转发/删除/收藏/导出（导出能力按策略灰置）
- 退出：Esc 或点击“退出多选”

### 3.6 会话详情（抽屉/替换视图）
- 单聊：资料、共同群、会话设置（置顶/免打扰/清空）、文件/图片/链接页签
- 群聊：群资料、公告、成员列表与搜索、我的群昵称、群设置（禁言、@全体权限、入群方式）、置顶区、文件中心

### 3.7 文件中心
- 页签：文件/图片/链接/代码
- 列表字段：名称、发送人、大小、时间、扫描状态、存储层级（热/冷）、过期时间
- 预览：图片/视频内联、PDF/Office/MD 在线预览、压缩包结构预览（沙箱）
- 批量：转发/收藏/下载/删除记录

---

## 4. 媒体直传与上传体验（对齐架构）

流程
1) 选择/拖拽文件 → 获取STS凭证 → 直传对象存储（显示分片进度、重试）
2) 成功后发送引用消息（WS） → 消息状态进入SENDING/ACCEPTED/STORED
3) 内容安全异步扫描 → UI徽标“检测中” → 合规后正常展示；命中违规则置灰/屏蔽

UI要点
- 进度：总进度+分片重试次数；失败时明确错误原因（网络/权限/大小超限）
- 原图/压缩：超过阈值弹窗选择，并可“记住我的选择”
- 限速提示（可选）：显示当前上传速度与限速策略说明

---

## 5. 搜索与历史（冷热分层）

### 5.1 全局搜索
- 条件：关键词、类型（消息/文件/图片/链接/代码）、发送人、时间范围、会话类型（单聊/群聊）
- 跨层提示：当时间超过“热30天”范围，顶部显示“包含归档数据，检索可能较慢”；结果卡片标记“归档”
- 点击结果定位至会话并高亮命中

### 5.2 会话内搜索
- 命中计数与上下跳转
- 快捷过滤：仅看图片/文件/链接/代码、按日期跳转
- 本地索引开关提示：未开启时显示“当前走云端检索，速度可能较慢”

---

## 6. 大群体验与群治理

### 6.1 大群“提示+拉取”
- 内容以占位卡/轻量摘要呈现；点击拉取全文/图片
- 列表中未读用“99+”聚合；设置中提供“在大群显示未读概数”的开关

### 6.2 公告与置顶
- 公告未读以独立徽标；进入会话顶部显著条“一键标记已读”
- 置顶数量上限可视化：显示剩余可置顶数；超限时提示“取消部分置顶以继续”

### 6.3 禁言与@全体
- 输入区禁言态提示；@全体权限不足时，@后显示气泡“无@全体权限”

---

## 7. 通知、勿扰与前台抑制

- 免打扰：静音消息；“@我仍提醒”可开关
- 前台聚焦抑制：当前会话在前台则不弹系统通知，仅更新计数
- 桌面通知：点击跳转定位消息；合并短时间内多条为摘要
- 任务栏/托盘徽标计数（桌面端）

---

## 8. 收藏与导出（合规）

- 收藏对象：消息/图片/文件/链接/代码片段；支持分组与批量
- 导出：HTML/JSON/PDF截图（按策略开放）；不允许时在批量动作中灰置并给出“受管理员策略限制”的说明
- 收藏详情可回跳来源会话

---

## 9. 设置中心（与策略映射）

- 账号与安全：二步验证、设备管理、全部登出
- 聊天与输入：Enter行为、表格粘贴策略、代码主题、气泡密度
- 外观与主题：亮/暗/随系统、紫色强度、高对比/色弱
- 文件与下载：默认目录、并发/断点续传、原图策略、限速（展示说明）
- 通知与声音：免打扰、仅@我、工作时段策略
- 隐私与权限：
  - 谁可向我发起会话（所有人/仅好友/同组织/共同群）
  - 从群直接加好友是否允许（开启/需验证/禁止）
  - 接收文件限制（扩展名/大小）
- 高级与实验：
  - 本地全文索引开关与容量
  - 大群“提示+拉取”偏好（跟随服务端/强制开启）
  - 多窗口与小窗置顶
- 关于：版本、检查更新、协议

---

## 10. 状态与错误反馈

- 连接与重连：顶部黄条短暂提示“连接已切换，正在校准会话进度…”，自动对账补齐
- 错误码映射（示例文案）
  - 1001 网络异常：发送失败，请检查网络后重试
  - 1003 权限超时：因权限通道繁忙，消息未发送（可稍后再试）
  - 2007 文件超限：文件超过大小限制，请压缩后再发
- 敏感词/外链风险：明确提示与“继续发送/取消”选项（按策略）
- 断网态：离线横幅、队列暂存、恢复后自动重发（网络错误场景）

---

## 11. 可观测与诊断（前端）

- 诊断面板（设置-高级/帮助）：
  - 网关节点、往返时延、重连次数、消息队列长度
  - 一键对账（按会话 lastSeq）、导出诊断包（脱敏）
- 问题上报：生成问题报告ID，便于与管理员沟通

---

## 12. 可用性与容错

- 空态：新用户/无会话/搜索无结果/文件中心空 → 提供引导与快捷入口
- 加载态：骨架屏、分页“加载更多”、跨冷层显示“正在检索归档…”
- 权限不足：展示“由管理员策略限制”，有权限申请入口时提供链接

---

## 13. 视觉规范（紫色主题建议）

- 主按钮：#6C40FF；Hover #5B33E8；Disabled 降20%不透明度
- 选中描边：2px 紫色描边，轻阴影
- 未读徽标：紫底白字、小圆角
- 状态色：成功绿/警告橙/错误红；配合图标与文字，不仅靠颜色

---

## 14. 版本里程碑与优先级

- P0
  - 消息状态机完整映射与文案
  - 大群“提示+拉取”UI与未读聚合
  - 冷热分层搜索提示与结果标记
  - 媒体直传流程与内容安全状态
  - 权限超时与合规复核/系统撤回复现
- P1
  - 文件中心显示扫描状态、存储层级、过期时间
  - 敏感/管控群标识与保守默认
  - 设置中心映射（本地索引/大群策略）
- P2
  - 诊断面板与一键对账
  - 更多导出格式与审计提示细化
  - 可访问性增强与快捷键可视化

---

## 15. 关键流程示意（文字版）

发消息（含直传与复核）
1) 选择文件/输入文本 → 若文件则直传展示进度  
2) 发送 → 显示 SENDING → ACCEPTED → STORED  
3) 敏感会话：气泡加“合规复核中”  
4) DELIVERED/READ 正常渲染；若复核不通过 → 替换为“已被系统撤回（原因…）”

加载历史（跨冷热）
1) 向上滚动加载 → 达到热层边界 → 显示“正在检索归档…”  
2) 归档返回 → 插入历史并标记“归档”来源

大群消息拉取
1) 进入大群 → 未读以卡片占位  
2) 点击卡片 → 拉取正文/图片 → 展示内容  
3) 设置中可选择“自动展开/按需加载”（默认跟随服务端）

撤回与影子审计
1) 用户在时限内撤回 → 消息替换为“消息已撤回（可能仍在审计留存）”  
2) 审计端保留影子记录；普通端不可见原文

---

附注
- 与后端的策略项需通过配置中心下发并在前端缓存：包括大群阈值、热层天数、内容扫描开关、撤回/编辑时限、导出权限、禁言与@全体权限等。
- 前端需容忍策略变更的热更新：展示短提示并在不重启的情况下应用新策略。

