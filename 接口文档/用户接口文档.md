# 用户接口文档

## 📋 目录

- [1. 接口概述](#1-接口概述)
- [2. 基础信息](#2-基础信息)
- [3. 用户注册](#3-用户注册)
- [4. 用户登录](#4-用户登录)
- [5. 用户登出](#5-用户登出)
- [6. 获取用户信息](#6-获取用户信息)
- [7. 更新用户信息](#7-更新用户信息)
- [8. 更新用户头像](#8-更新用户头像)
- [9. 修改密码](#9-修改密码)
- [10. 重置密码](#10-重置密码)
- [11. 搜索用户](#11-搜索用户)
- [12. 设备管理](#12-设备管理)
- [13. 隐私设置](#13-隐私设置)
- [14. 黑名单管理](#14-黑名单管理)
- [15. 高级搜索](#15-高级搜索)
- [16. 统计信息](#16-统计信息)
- [17. 错误码说明](#17-错误码说明)

---

## 1. 接口概述

### 1.1 服务信息
- **服务名称**: IM用户管理服务
- **服务地址**: `http://localhost:8081`
- **基础路径**: `/api/users`
- **协议**: HTTP/HTTPS
- **数据格式**: JSON

### 1.2 认证方式
- **认证类型**: JWT (JSON Web Token)
- **Header格式**: `Authorization: Bearer {token}`
- **Token有效期**: 30分钟（访问令牌）

### 1.3 响应格式
所有接口统一使用以下响应格式：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": "2025-08-13T13:50:21"
}
```

---

## 2. 基础信息

### 2.1 请求头
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | 固定值：application/json |
| Authorization | String | 否 | Bearer {JWT Token} |

### 2.2 通用响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| code | Integer | 响应状态码 |
| message | String | 响应消息 |
| data | Object | 响应数据 |
| timestamp | String | 响应时间戳 |

### 2.3 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 201 | 创建成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

---

## 3. 用户注册

### 3.1 接口信息
- **接口路径**: `POST /api/users/register`
- **接口描述**: 用户注册
- **认证要求**: 无需认证

### 3.2 请求参数
```json
{
  "username": "testuser",
  "password": "123456",
  "deviceId": "device001"
}
```

| 字段名 | 类型 | 必填 | 长度限制 | 说明 |
|--------|------|------|----------|------|
| username | String | 是 | 3-20字符 | 用户名，只能包含字母 |
| password | String | 是 | 6-20字符 | 密码 |
| deviceId | String | 是 | 1-50字符 | 设备标识 |

### 3.3 响应示例
```json
{
  "code": 201,
  "message": "用户注册成功",
  "data": {
    "id": 5,
    "username": "testuser",
    "nickname": "testuser",
    "status": 1,
    "onlineStatus": 0,
    "createdAt": "2025-08-13T13:24:19",
    "updatedAt": "2025-08-13T13:24:19"
  },
  "timestamp": "2025-08-13T13:24:19"
}
```

---

## 4. 用户登录

### 4.1 接口信息
- **接口路径**: `POST /api/users/login`
- **接口描述**: 用户登录
- **认证要求**: 无需认证

### 4.2 请求参数
```json
{
  "username": "testuser",
  "password": "123456",
  "deviceId": "device001"
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| username | String | 是 | 用户名 |
| password | String | 是 | 密码 |
| deviceId | String | 是 | 设备标识 |

### 4.3 响应示例
```json
{
  "code": 200,
  "message": "用户登录成功",
  "data": "eyJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWNjZXNzIiwiZGV2aWNlSWQiOiJkZXZpY2UwMDEiLCJzdWIiOiJ0ZXN0dXNlciIsImlzcyI6ImltLXN5c3RlbSIsImF1ZCI6WyJpbS11c2VycyJdLCJpYXQiOjE3NTUwNjc4MjEsImV4cCI6MTc1NTI4MzgyMX0.GNXcTs7Y517-dVWKBLaoSCzLzPn9N5WcGQ5xQKB1mME",
  "timestamp": "2025-08-13T13:50:21"
}
```

---

## 5. 用户登出

### 5.1 接口信息
- **接口路径**: `POST /api/users/logout`
- **接口描述**: 用户登出
- **认证要求**: 需要JWT认证

### 5.2 请求头
```
Authorization: Bearer {JWT Token}
```

### 5.3 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| deviceId | String | 是 | 设备标识 |

### 5.4 响应示例
```json
{
  "code": 200,
  "message": "用户登出成功",
  "data": "登出成功",
  "timestamp": "2025-08-13T13:55:00"
}
```

---

## 6. 获取用户信息

### 6.1 接口信息
- **接口路径**: `GET /api/users/profile`
- **接口描述**: 获取当前用户信息
- **认证要求**: 需要JWT认证

### 6.2 请求头
```
Authorization: Bearer {JWT Token}
```

### 6.3 响应示例
```json
{
  "code": 200,
  "message": "获取用户信息成功",
  "data": {
    "id": 5,
    "username": "testuser",
    "email": null,
    "phone": null,
    "nickname": "新昵称",
    "avatarUrl": "https://example.com/avatar.jpg",
    "signature": "这是我的个性签名",
    "gender": 1,
    "birthday": null,
    "region": null,
    "status": 1,
    "onlineStatus": 1,
    "lastLoginAt": "2025-08-13T13:50:21",
    "lastActiveAt": "2025-08-13T13:50:21",
    "createdAt": "2025-08-13T13:24:19",
    "updatedAt": "2025-08-13T13:50:42"
  },
  "timestamp": "2025-08-13T13:55:30"
}
```

---

## 7. 更新用户信息

### 7.1 接口信息
- **接口路径**: `PUT /api/users/profile`
- **接口描述**: 更新用户信息
- **认证要求**: 需要JWT认证

### 7.2 请求头
```
Authorization: Bearer {JWT Token}
Content-Type: application/json
```

### 7.3 请求参数
```json
{
  "nickname": "新昵称",
  "signature": "这是我的个性签名",
  "gender": 1
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| nickname | String | 否 | 昵称 |
| signature | String | 否 | 个性签名 |
| gender | Integer | 否 | 性别：0-未知，1-男，2-女 |
| birthday | String | 否 | 生日（ISO 8601格式） |
| region | String | 否 | 地区 |

### 7.4 响应示例
```json
{
  "code": 200,
  "message": "用户信息更新成功",
  "data": {
    "id": 5,
    "username": "testuser",
    "nickname": "新昵称",
    "signature": "这是我的个性签名",
    "gender": 1,
    "updatedAt": "2025-08-13T13:55:45.869144"
  },
  "timestamp": "2025-08-13T13:55:45"
}
```

---

## 8. 更新用户头像

### 8.1 接口信息
- **接口路径**: `PUT /api/users/avatar`
- **接口描述**: 更新用户头像
- **认证要求**: 需要JWT认证

### 8.2 请求头
```
Authorization: Bearer {JWT Token}
```

### 8.3 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| avatarUrl | String | 是 | 头像URL地址 |

### 8.4 响应示例
```json
{
  "code": 200,
  "message": "头像更新成功",
  "data": "更新成功",
  "timestamp": "2025-08-13T13:56:00"
}
```

---

## 9. 修改密码

### 9.1 接口信息
- **接口路径**: `PUT /api/users/password`
- **接口描述**: 修改用户密码
- **认证要求**: 需要JWT认证

### 9.2 请求头
```
Authorization: Bearer {JWT Token}
Content-Type: application/json
```

### 9.3 请求参数
```json
{
  "oldPassword": "123456",
  "newPassword": "newpass123"
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| oldPassword | String | 是 | 旧密码 |
| newPassword | String | 是 | 新密码 |

### 9.4 响应示例
```json
{
  "code": 200,
  "message": "密码修改成功",
  "data": "修改成功",
  "timestamp": "2025-08-13T13:56:30"
}
```

---

## 10. 重置密码

### 10.1 接口信息
- **接口路径**: `POST /api/users/reset-password`
- **接口描述**: 重置用户密码
- **认证要求**: 无需认证

### 10.2 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| email | String | 是 | 用户邮箱 |

### 10.3 响应示例
```json
{
  "code": 200,
  "message": "密码重置成功，请查看邮箱",
  "data": "重置成功",
  "timestamp": "2025-08-13T13:57:00"
}
```

---

## 11. 搜索用户

### 11.1 接口信息
- **接口路径**: `GET /api/users/search`
- **接口描述**: 搜索用户
- **认证要求**: 需要JWT认证

### 11.2 请求头
```
Authorization: Bearer {JWT Token}
```

### 11.3 请求参数
| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| keyword | String | 是 | - | 搜索关键词 |
| limit | Integer | 否 | 20 | 返回结果数量限制 |

### 11.4 响应示例
```json
{
  "code": 200,
  "message": "搜索用户成功",
  "data": [
    {
      "id": 5,
      "username": "testuser",
      "nickname": "新昵称",
      "avatarUrl": "https://example.com/avatar.jpg",
      "signature": "这是我的个性签名",
      "gender": 1,
      "status": 1,
      "onlineStatus": 1,
      "lastLoginAt": "2025-08-13T13:50:21",
      "lastActiveAt": "2025-08-13T13:50:21",
      "createdAt": "2025-08-13T13:24:19",
      "updatedAt": "2025-08-13T13:50:42"
    }
  ],
  "timestamp": "2025-08-13T13:57:30"
}
```

---

## 12. 设备管理

### 12.1 获取用户设备列表
- **接口路径**: `GET /api/users/{userId}/devices`
- **接口描述**: 获取用户的所有设备信息
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |

#### 响应示例
```json
{
  "code": 200,
  "message": "获取设备列表成功",
  "data": [
    {
      "id": 1,
      "deviceId": "device001",
      "deviceName": "iPhone 15",
      "deviceType": "mobile",
      "isTrusted": true,
      "lastLoginAt": "2025-08-13T13:50:21",
      "createdAt": "2025-08-13T13:24:19"
    }
  ],
  "timestamp": "2025-08-13T13:58:00"
}
```

### 12.2 添加用户设备
- **接口路径**: `POST /api/users/{userId}/devices`
- **接口描述**: 为用户添加新设备
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |

#### 请求体
```json
{
  "deviceId": "device002",
  "deviceName": "MacBook Pro",
  "deviceType": "desktop",
  "isTrusted": false
}
```

#### 响应示例
```json
{
  "code": 200,
  "message": "添加设备成功",
  "data": {
    "id": 2,
    "deviceId": "device002",
    "deviceName": "MacBook Pro",
    "deviceType": "desktop",
    "isTrusted": false,
    "lastLoginAt": "2025-08-13T13:59:00",
    "createdAt": "2025-08-13T13:59:00"
  },
  "timestamp": "2025-08-13T13:59:00"
}
```

### 12.3 移除用户设备
- **接口路径**: `DELETE /api/users/{userId}/devices/{deviceId}`
- **接口描述**: 移除用户的指定设备
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |
| deviceId | String | 是 | 设备ID |

#### 响应示例
```json
{
  "code": 200,
  "message": "移除设备成功",
  "data": true,
  "timestamp": "2025-08-13T14:00:00"
}
```

### 12.4 设置设备信任状态
- **接口路径**: `PUT /api/users/{userId}/devices/{deviceId}/trust`
- **接口描述**: 设置设备的信任状态
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |
| deviceId | String | 是 | 设备ID |
| isTrusted | Boolean | 是 | 是否信任 |

#### 响应示例
```json
{
  "code": 200,
  "message": "设置设备信任状态成功",
  "data": true,
  "timestamp": "2025-08-13T14:01:00"
}
```

---

## 13. 隐私设置

### 13.1 获取用户隐私设置
- **接口路径**: `GET /api/users/{userId}/privacy`
- **接口描述**: 获取用户的隐私设置
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |

#### 响应示例
```json
{
  "code": 200,
  "message": "获取隐私设置成功",
  "data": {
    "userId": 5,
    "friendRequestMode": 1,
    "allowSearchByUsername": true,
    "allowSearchByPhone": false,
    "allowSearchByEmail": false,
    "allowGroupInvite": true,
    "allowStrangerMessage": false,
    "messageReadReceipt": true,
    "onlineStatusVisible": true,
    "createdAt": "2025-08-13T13:24:19",
    "updatedAt": "2025-08-13T13:24:19"
  },
  "timestamp": "2025-08-13T14:02:00"
}
```

### 13.2 更新用户隐私设置
- **接口路径**: `PUT /api/users/{userId}/privacy`
- **接口描述**: 更新用户的隐私设置
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |

#### 请求体
```json
{
  "friendRequestMode": 1,
  "allowSearchByUsername": true,
  "allowSearchByPhone": false,
  "allowSearchByEmail": false,
  "allowGroupInvite": true,
  "allowStrangerMessage": false,
  "messageReadReceipt": true,
  "onlineStatusVisible": true
}
```

#### 响应示例
```json
{
  "code": 200,
  "message": "更新隐私设置成功",
  "data": {
    "userId": 5,
    "friendRequestMode": 1,
    "allowSearchByUsername": true,
    "allowSearchByPhone": false,
    "allowSearchByEmail": false,
    "allowGroupInvite": true,
    "allowStrangerMessage": false,
    "messageReadReceipt": true,
    "onlineStatusVisible": true,
    "createdAt": "2025-08-13T13:24:19",
    "updatedAt": "2025-08-13T14:03:00"
  },
  "timestamp": "2025-08-13T14:03:00"
}
```

---

## 14. 黑名单管理

### 14.1 获取用户黑名单
- **接口路径**: `GET /api/users/{userId}/blacklist`
- **接口描述**: 获取用户的黑名单列表
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |

#### 响应示例
```json
{
  "code": 200,
  "message": "获取黑名单成功",
  "data": [
    {
      "id": 1,
      "userId": 5,
      "blockedUserId": 10,
      "blockType": 1,
      "reason": "骚扰行为",
      "createdAt": "2025-08-13T14:04:00"
    }
  ],
  "timestamp": "2025-08-13T14:04:00"
}
```

### 14.2 添加用户到黑名单
- **接口路径**: `POST /api/users/{userId}/blacklist`
- **接口描述**: 将用户添加到黑名单
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |

#### 请求体
```json
{
  "blockedUserId": 10,
  "blockType": 1,
  "reason": "骚扰行为"
}
```

#### 响应示例
```json
{
  "code": 200,
  "message": "添加到黑名单成功",
  "data": {
    "id": 1,
    "userId": 5,
    "blockedUserId": 10,
    "blockType": 1,
    "reason": "骚扰行为",
    "createdAt": "2025-08-13T14:05:00"
  },
  "timestamp": "2025-08-13T14:05:00"
}
```

### 14.3 从黑名单移除用户
- **接口路径**: `DELETE /api/users/{userId}/blacklist/{blockedUserId}`
- **接口描述**: 从黑名单中移除用户
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |
| blockedUserId | Long | 是 | 被拉黑用户ID |

#### 响应示例
```json
{
  "code": 200,
  "message": "从黑名单移除成功",
  "data": true,
  "timestamp": "2025-08-13T14:06:00"
}
```

### 14.4 检查用户黑名单状态
- **接口路径**: `GET /api/users/{userId}/blacklist/check/{targetUserId}`
- **接口描述**: 检查指定用户是否在黑名单中
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |
| targetUserId | Long | 是 | 目标用户ID |

#### 响应示例
```json
{
  "code": 200,
  "message": "检查黑名单状态成功",
  "data": true,
  "timestamp": "2025-08-13T14:07:00"
}
```

---

## 15. 高级搜索

### 15.1 根据用户名搜索
- **接口路径**: `GET /api/users/search/username`
- **接口描述**: 根据用户名进行精确搜索
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| username | String | 是 | - | 用户名 |
| limit | Integer | 否 | 20 | 返回结果数量限制 |

#### 响应示例
```json
{
  "code": 200,
  "message": "根据用户名搜索成功",
  "data": [
    {
      "id": 5,
      "username": "testuser",
      "nickname": "新昵称",
      "avatarUrl": "https://example.com/avatar.jpg",
      "status": 1,
      "onlineStatus": 1
    }
  ],
  "timestamp": "2025-08-13T14:08:00"
}
```

### 15.2 根据昵称搜索
- **接口路径**: `GET /api/users/search/nickname`
- **接口描述**: 根据昵称进行模糊搜索
- **认证要求**: 需要JWT认证

#### 请求参数
| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| nickname | String | 是 | - | 昵称 |
| limit | Integer | 否 | 20 | 返回结果数量限制 |

#### 响应示例
```json
{
  "code": 200,
  "message": "根据昵称搜索成功",
  "data": [
    {
      "id": 5,
      "username": "testuser",
      "nickname": "新昵称",
      "avatarUrl": "https://example.com/avatar.jpg",
      "status": 1,
      "onlineStatus": 1
    }
  ],
  "timestamp": "2025-08-13T14:09:00"
}
```

### 15.3 高级搜索
- **接口路径**: `POST /api/users/search/advanced`
- **接口描述**: 支持多条件的高级搜索
- **认证要求**: 需要JWT认证

#### 请求体
```json
{
  "username": "test",
  "nickname": "昵称",
  "email": "test@example.com",
  "phone": "13800138000",
  "region": "北京",
  "gender": 1,
  "limit": 20
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| username | String | 否 | 用户名（模糊匹配） |
| nickname | String | 否 | 昵称（模糊匹配） |
| email | String | 否 | 邮箱（精确匹配） |
| phone | String | 否 | 手机号（精确匹配） |
| region | String | 否 | 地区（模糊匹配） |
| gender | Integer | 否 | 性别：0-未知，1-男，2-女 |
| limit | Integer | 否 | 返回结果数量限制，默认20 |

#### 响应示例
```json
{
  "code": 200,
  "message": "高级搜索成功",
  "data": [
    {
      "id": 5,
      "username": "testuser",
      "nickname": "新昵称",
      "email": "test@example.com",
      "phone": "13800138000",
      "region": "北京",
      "gender": 1,
      "status": 1,
      "onlineStatus": 1
    }
  ],
  "timestamp": "2025-08-13T14:10:00"
}
```

---

## 16. 统计信息

### 16.1 获取在线用户数量
- **接口路径**: `GET /api/users/online-count`
- **接口描述**: 获取当前在线用户数量
- **认证要求**: 需要JWT认证

#### 响应示例
```json
{
  "code": 200,
  "message": "获取在线用户数量成功",
  "data": 1250,
  "timestamp": "2025-08-13T14:11:00"
}
```

### 16.2 获取用户统计信息
- **接口路径**: `GET /api/users/statistics`
- **接口描述**: 获取用户相关的统计信息
- **认证要求**: 需要JWT认证

#### 响应示例
```json
{
  "code": 200,
  "message": "获取用户统计信息成功",
  "data": {
    "totalUsers": 5000,
    "activeUsers": 1250,
    "newUsersToday": 25,
    "newUsersThisWeek": 150,
    "newUsersThisMonth": 580,
    "onlineUsers": 1250,
    "offlineUsers": 3750,
    "verifiedUsers": 4800,
    "unverifiedUsers": 200
  },
  "timestamp": "2025-08-13T14:12:00"
}
```

---

## 17. 错误码说明

### 17.1 通用错误码
| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| 400 | 请求参数错误 | 检查请求参数格式和必填字段 |
| 401 | 未授权 | 检查JWT Token是否有效 |
| 403 | 禁止访问 | 检查用户权限 |
| 404 | 资源不存在 | 检查请求的资源是否存在 |
| 500 | 服务器内部错误 | 联系技术支持 |

### 17.2 业务错误码
| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| USER_NOT_FOUND | 用户不存在 | 检查用户名是否正确 |
| PASSWORD_ERROR | 密码错误 | 检查密码是否正确 |
| USERNAME_EXISTS | 用户名已存在 | 选择其他用户名 |
| TOKEN_EXPIRED | Token已过期 | 重新登录获取新Token |
| INVALID_TOKEN | 无效的Token | 检查Token格式是否正确 |
| DEVICE_NOT_FOUND | 设备不存在 | 检查设备ID是否正确 |
| DEVICE_ALREADY_EXISTS | 设备已存在 | 检查是否重复添加 |
| BLACKLIST_ALREADY_EXISTS | 用户已在黑名单中 | 检查黑名单状态 |
| PRIVACY_SETTINGS_NOT_FOUND | 隐私设置不存在 | 先创建隐私设置 |

---

## 📞 技术支持

如有问题，请联系开发团队：
- **邮箱**: dev@im-system.com
- **文档版本**: v2.0.0
- **更新时间**: 2025-08-14
- **更新内容**: 添加设备管理、隐私设置、黑名单管理、高级搜索、统计信息等接口
