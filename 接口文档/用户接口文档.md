# 用户接口文档

## 📋 目录

- [1. 接口概述](#1-接口概述)
- [2. 基础信息](#2-基础信息)
- [3. 用户注册](#3-用户注册)
- [4. 用户登录](#4-用户登录)
- [5. 用户登出](#5-用户登出)
- [6. 获取用户信息](#6-获取用户信息)
- [7. 更新用户信息](#7-更新用户信息)
- [8. 更新用户头像](#8-更新用户头像)
- [9. 修改密码](#9-修改密码)
- [10. 重置密码](#10-重置密码)
- [11. 搜索用户](#11-搜索用户)
- [12. 错误码说明](#12-错误码说明)

---

## 1. 接口概述

### 1.1 服务信息
- **服务名称**: IM用户管理服务
- **服务地址**: `http://localhost:8081`
- **基础路径**: `/api/users`
- **协议**: HTTP/HTTPS
- **数据格式**: JSON

### 1.2 认证方式
- **认证类型**: JWT (JSON Web Token)
- **Header格式**: `Authorization: Bearer {token}`
- **Token有效期**: 30分钟（访问令牌）

### 1.3 响应格式
所有接口统一使用以下响应格式：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": "2025-08-13 13:50:21",
  "error": false,
  "success": true
}
```

---

## 2. 基础信息

### 2.1 请求头
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | 固定值：application/json |
| Authorization | String | 否 | Bearer {JWT Token} |

### 2.2 通用响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| code | Integer | 响应状态码 |
| message | String | 响应消息 |
| data | Object | 响应数据 |
| timestamp | String | 响应时间戳 |
| error | Boolean | 是否错误 |
| success | Boolean | 是否成功 |

### 2.3 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 201 | 创建成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

---

## 3. 用户注册

### 3.1 接口信息
- **接口路径**: `POST /api/users/register`
- **接口描述**: 用户注册
- **认证要求**: 无需认证

### 3.2 请求参数
```json
{
  "username": "testuser",
  "password": "123456",
  "deviceId": "device001"
}
```

| 字段名 | 类型 | 必填 | 长度限制 | 说明 |
|--------|------|------|----------|------|
| username | String | 是 | 3-20字符 | 用户名，只能包含字母 |
| password | String | 是 | 6-20字符 | 密码 |
| deviceId | String | 是 | 1-50字符 | 设备标识 |

### 3.3 响应示例
```json
{
  "code": 201,
  "message": "用户注册成功",
  "data": {
    "id": 5,
    "username": "testuser",
    "nickname": "testuser",
    "status": 1,
    "onlineStatus": 0,
    "createdAt": "2025-08-13T13:24:19",
    "updatedAt": "2025-08-13T13:24:19"
  },
  "timestamp": "2025-08-13 13:24:19",
  "error": false,
  "success": true
}
```

---

## 4. 用户登录

### 4.1 接口信息
- **接口路径**: `POST /api/users/login`
- **接口描述**: 用户登录
- **认证要求**: 无需认证

### 4.2 请求参数
```json
{
  "username": "testuser",
  "password": "123456",
  "deviceId": "device001"
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| username | String | 是 | 用户名 |
| password | String | 是 | 密码 |
| deviceId | String | 是 | 设备标识 |

### 4.3 响应示例
```json
{
  "code": 200,
  "message": "用户登录成功",
  "data": "eyJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWNjZXNzIiwiZGV2aWNlSWQiOiJkZXZpY2UwMDEiLCJzdWIiOiJ0ZXN0dXNlciIsImlzcyI6ImltLXN5c3RlbSIsImF1ZCI6WyJpbS11c2VycyJdLCJpYXQiOjE3NTUwNjc4MjEsImV4cCI6MTc1NTI4MzgyMX0.GNXcTs7Y517-dVWKBLaoSCzLzPn9N5WcGQ5xQKB1mME",
  "timestamp": "2025-08-13 13:50:21",
  "error": false,
  "success": true
}
```

---

## 5. 用户登出

### 5.1 接口信息
- **接口路径**: `POST /api/users/logout`
- **接口描述**: 用户登出
- **认证要求**: 需要JWT认证

### 5.2 请求头
```
Authorization: Bearer {JWT Token}
```

### 5.3 响应示例
```json
{
  "code": 200,
  "message": "用户登出成功",
  "data": "登出成功",
  "timestamp": "2025-08-13 13:55:00",
  "error": false,
  "success": true
}
```

---

## 6. 获取用户信息

### 6.1 接口信息
- **接口路径**: `GET /api/users/profile`
- **接口描述**: 获取当前用户信息
- **认证要求**: 需要JWT认证

### 6.2 请求头
```
Authorization: Bearer {JWT Token}
```

### 6.3 响应示例
```json
{
  "code": 200,
  "message": "获取用户信息成功",
  "data": {
    "id": 5,
    "username": "testuser",
    "email": null,
    "phone": null,
    "nickname": "新昵称",
    "avatarUrl": "https://example.com/avatar.jpg",
    "signature": "这是我的个性签名",
    "gender": 1,
    "birthday": null,
    "region": null,
    "status": 1,
    "onlineStatus": 1,
    "lastLoginAt": "2025-08-13T13:50:21",
    "lastActiveAt": "2025-08-13T13:50:21",
    "createdAt": "2025-08-13T13:24:19",
    "updatedAt": "2025-08-13T13:50:42"
  },
  "timestamp": "2025-08-13 13:55:30",
  "error": false,
  "success": true
}
```

---

## 7. 更新用户信息

### 7.1 接口信息
- **接口路径**: `PUT /api/users/profile`
- **接口描述**: 更新用户信息
- **认证要求**: 需要JWT认证

### 7.2 请求头
```
Authorization: Bearer {JWT Token}
Content-Type: application/json
```

### 7.3 请求参数
```json
{
  "nickname": "新昵称",
  "signature": "这是我的个性签名",
  "gender": 1
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| nickname | String | 否 | 昵称 |
| signature | String | 否 | 个性签名 |
| gender | Integer | 否 | 性别：0-未知，1-男，2-女 |
| birthday | String | 否 | 生日（ISO 8601格式） |
| region | String | 否 | 地区 |

### 7.4 响应示例
```json
{
  "code": 200,
  "message": "用户信息更新成功",
  "data": {
    "id": 5,
    "username": "testuser",
    "nickname": "新昵称",
    "signature": "这是我的个性签名",
    "gender": 1,
    "updatedAt": "2025-08-13T13:55:45.869144"
  },
  "timestamp": "2025-08-13 13:55:45",
  "error": false,
  "success": true
}
```

---

## 8. 更新用户头像

### 8.1 接口信息
- **接口路径**: `PUT /api/users/avatar`
- **接口描述**: 更新用户头像
- **认证要求**: 需要JWT认证

### 8.2 请求头
```
Authorization: Bearer {JWT Token}
```

### 8.3 请求参数
```
avatarUrl=https://example.com/avatar.jpg
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| avatarUrl | String | 是 | 头像URL地址 |

### 8.4 响应示例
```json
{
  "code": 200,
  "message": "头像更新成功",
  "data": "更新成功",
  "timestamp": "2025-08-13 13:56:00",
  "error": false,
  "success": true
}
```

---

## 9. 修改密码

### 9.1 接口信息
- **接口路径**: `PUT /api/users/password`
- **接口描述**: 修改用户密码
- **认证要求**: 需要JWT认证

### 9.2 请求头
```
Authorization: Bearer {JWT Token}
Content-Type: application/json
```

### 9.3 请求参数
```json
{
  "oldPassword": "123456",
  "newPassword": "newpass123"
}
```

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| oldPassword | String | 是 | 旧密码 |
| newPassword | String | 是 | 新密码 |

### 9.4 响应示例
```json
{
  "code": 200,
  "message": "密码修改成功",
  "data": "修改成功",
  "timestamp": "2025-08-13 13:56:30",
  "error": false,
  "success": true
}
```

---

## 10. 重置密码

### 10.1 接口信息
- **接口路径**: `POST /api/users/reset-password`
- **接口描述**: 重置用户密码
- **认证要求**: 无需认证

### 10.2 请求参数
```
email=user@example.com
```

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| email | String | 是 | 用户邮箱 |

### 10.3 响应示例
```json
{
  "code": 200,
  "message": "密码重置成功，请查看邮箱",
  "data": "重置成功",
  "timestamp": "2025-08-13 13:57:00",
  "error": false,
  "success": true
}
```

---

## 11. 搜索用户

### 11.1 接口信息
- **接口路径**: `GET /api/users/search`
- **接口描述**: 搜索用户
- **认证要求**: 需要JWT认证

### 11.2 请求头
```
Authorization: Bearer {JWT Token}
```

### 11.3 请求参数
```
keyword=test&limit=10
```

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| keyword | String | 是 | - | 搜索关键词 |
| limit | Integer | 否 | 20 | 返回结果数量限制 |

### 11.4 响应示例
```json
{
  "code": 200,
  "message": "搜索用户成功",
  "data": [
    {
      "id": 5,
      "username": "testuser",
      "nickname": "新昵称",
      "avatarUrl": "https://example.com/avatar.jpg",
      "signature": "这是我的个性签名",
      "gender": 1,
      "status": 1,
      "onlineStatus": 1,
      "lastLoginAt": "2025-08-13T13:50:21",
      "lastActiveAt": "2025-08-13T13:50:21",
      "createdAt": "2025-08-13T13:24:19",
      "updatedAt": "2025-08-13T13:50:42"
    }
  ],
  "timestamp": "2025-08-13 13:57:30",
  "error": false,
  "success": true
}
```

---

## 12. 错误码说明

### 12.1 通用错误码
| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| 400 | 请求参数错误 | 检查请求参数格式和必填字段 |
| 401 | 未授权 | 检查JWT Token是否有效 |
| 403 | 禁止访问 | 检查用户权限 |
| 404 | 资源不存在 | 检查请求的资源是否存在 |
| 500 | 服务器内部错误 | 联系技术支持 |

### 12.2 业务错误码
| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| USER_NOT_FOUND | 用户不存在 | 检查用户名是否正确 |
| PASSWORD_ERROR | 密码错误 | 检查密码是否正确 |
| USERNAME_EXISTS | 用户名已存在 | 选择其他用户名 |
| TOKEN_EXPIRED | Token已过期 | 重新登录获取新Token |
| INVALID_TOKEN | 无效的Token | 检查Token格式是否正确 |

---

## 📞 技术支持

如有问题，请联系开发团队：
- **邮箱**: dev@im-system.com
- **文档版本**: v1.0.0
- **更新时间**: 2025-08-13
