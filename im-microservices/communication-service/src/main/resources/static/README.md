# IM系统测试页面使用说明

## 概述

这是一个完整的IM系统测试页面，用于测试WebSocket连接、用户模块功能和事件处理机制。

## 功能特性

### 🔌 WebSocket连接测试
- 连接/断开WebSocket
- 发送认证消息
- 实时消息收发
- 连接状态监控

### 👤 用户模块功能测试
- 用户注册
- 用户登录/登出
- 个人资料管理
- 设备管理

### 📡 事件处理测试
- WebSocket消息测试
- 事件监听
- 性能测试
- 实时日志

### 📊 系统状态监控
- 连接状态监控
- 性能指标
- 事件统计

## 使用方法

### 1. 启动服务

确保以下服务已启动：

```bash
# 启动基础设施服务
cd im-microservices
./scripts/start-infrastructure.sh

# 启动业务服务（端口8081）
cd business-service
mvn spring-boot:run

# 启动通信服务（端口8081）
cd communication-service
mvn spring-boot:run
```

### 2. 访问测试页面

在浏览器中打开：
```
http://localhost:8081/index.html
```

### 3. 测试流程

#### 第一步：WebSocket连接
1. 点击"连接WebSocket"按钮
2. 观察连接状态变化
3. 确认WebSocket连接成功

#### 第二步：用户注册
1. 填写用户名、密码、设备ID
2. 点击"注册用户"按钮
3. 观察注册结果

#### 第三步：用户登录
1. 使用注册的用户名和密码登录
2. 获取JWT Token
3. 自动填充到WebSocket认证字段

#### 第四步：WebSocket认证
1. 点击"发送认证消息"按钮
2. 观察认证结果
3. 确认用户认证状态

#### 第五步：功能测试
1. 测试各种WebSocket消息发送
2. 测试用户资料管理
3. 测试设备管理
4. 观察事件处理和日志

## 测试场景

### 场景1：基础连接测试
- 测试WebSocket连接建立
- 测试连接断开
- 测试连接重连

### 场景2：用户认证测试
- 测试用户注册流程
- 测试用户登录流程
- 测试Token认证
- 测试用户登出

### 场景3：消息通信测试
- 测试聊天消息发送
- 测试控制消息
- 测试心跳消息
- 测试消息延迟

### 场景4：事件处理测试
- 测试事件监听
- 测试事件发布
- 测试事件响应
- 测试事件统计

### 场景5：性能测试
- 测试响应时间
- 测试消息延迟
- 测试并发连接
- 测试压力测试

## 注意事项

### 1. 端口配置
- 业务服务：8081端口
- 通信服务：8081端口
- WebSocket：ws://localhost:8081/ws

### 2. 环境要求
- 确保MySQL、Redis、NATS服务正常运行
- 确保数据库已初始化
- 确保网络连接正常

### 3. 安全考虑
- 测试环境允许所有CORS源
- 生产环境需要限制允许的源
- JWT Token需要妥善保管

### 4. 故障排除

#### CORS错误
如果遇到CORS错误，检查：
- CORS配置是否正确
- 服务是否正常启动
- 端口是否正确

#### WebSocket连接失败
如果WebSocket连接失败，检查：
- 通信服务是否启动
- 端口是否被占用
- 防火墙设置

#### 用户认证失败
如果用户认证失败，检查：
- 业务服务是否启动
- 数据库连接是否正常
- JWT配置是否正确

## 开发调试

### 1. 日志查看
- 查看浏览器控制台日志
- 查看服务端应用日志
- 查看WebSocket连接日志

### 2. 网络调试
- 使用浏览器开发者工具
- 查看Network标签页
- 查看WebSocket连接状态

### 3. 代码调试
- 在关键位置添加断点
- 使用日志输出调试信息
- 检查事件处理流程

## 扩展功能

### 1. 添加新的测试用例
- 在HTML中添加新的测试按钮
- 在JavaScript中添加对应的处理函数
- 更新测试文档

### 2. 集成自动化测试
- 使用Selenium进行自动化测试
- 集成到CI/CD流程
- 生成测试报告

### 3. 性能监控
- 集成Prometheus监控
- 添加性能指标收集
- 设置性能告警

## 联系支持

如有问题或建议，请联系：
- 开发团队：IM开发团队
- 邮箱：dev@acme.com
- 项目地址：https://github.com/acme/im-system 